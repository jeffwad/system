(function(a){function l(a,b){var c,d,e=!1;typeof a.callProto!="function"&&(a=Object.create(a),a.callProto=function(a,b){var c=this[a].callProto;return c.apply(this,b)}),d=Object.create(a);if(typeof b=="object")for(c in b)typeof d[c]=="function"&&(e=d[c]),d[c]=b[c],e&&(d[c].callProto=e),e=!1;return d}function m(a,b){var c;for(c in b)a[c]=b[c]}function n(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function o(a){var b=!1,c,d;if(typeof a.next=="function")b=a;else if(typeof a.__iterator__=="function")b=a.__iterator__();else if(a.length)c=0,b={next:function(){if(typeof a[c]!="undefined")return[a[c],c++];throw StopIteration}};else try{d=Object.keys(a),c=0,b={next:function(){if(typeof d[c]!="undefined")return[a[d[c]],d[c++]];throw StopIteration}}}catch(e){b=!1}return b}function p(a,b){var c,d,e,f;try{if(typeof a.length=="number")for(c=0,d=a.length;c<d;c++)b(a[c],c);else{f=o(a);if(f){c=0;for(;;)e=f.next(),b(e[0],e[1])}else for(c in a)a.hasOwnProperty(c)&&b(a[c],c)}}catch(g){if(g!==StopIteration)throw g}}function q(a,b,c){typeof a.forEach=="function"?a.forEach(b,c):p(a,function(a,d){b.call(c,a,d)})}function r(a,b,c){if(typeof a.filter=="function")return a.filter(b,c);var d=a.length?[]:{};return p(a,function(e,f){b.call(c,e,f)&&(a.length?d.push(e):d[f]=e)}),d}function s(a,b,c){if(typeof a.map=="function")return a.map(b,c);var d=a.length?[]:{};return p(a,function(e,f){var g=b.call(c,e,f);a.length?d.push(g):d[f]=g}),d}function t(a,b,c){if(typeof a.some=="function")return a.some(b,c);var d=!1;return p(a,function(a,e){if(d=b.call(c,a,e))throw StopIteration}),d}function u(a,b,c){if(typeof a.every=="function")return a.every(b,c);var d=!0;return p(a,function(a,e){if(!(d=b.call(c,a,e)))throw StopIteration}),d}function v(a,b){if(typeof a.indexOf=="function")return a.indexOf(b);var c=-1;return p(a,function(a,d){if(a===b)throw c=d,StopIteration}),c}function w(a,b){if(typeof a.lastIndexOf=="function")return a.lastIndexOf(b);var c=-1;return p(a,function(a,d){a===b&&(c=d)}),c}function x(a){var b=[];return p(a,function(a,c){b.push(a)}),b}function y(a,b,c,d){return p(b,function(b,e){a=c.call(d,a,b,e)}),a}function z(a,b){return y(b||0,a,function(a,b){return a+b})}function A(a,b){return s(a,function(a){return a[b]})}function B(){if(arguments.length===1)return o(arguments[0]);var a=s(arguments,o);return{next:function(){try{return a[0].next()}catch(b){if(b!==StopIteration)throw b;if(a.length===1)throw StopIteration;return a.shift(),a[0].next()}}}}function C(){var a,c,d=0,e=arguments.length,f=arguments,g=[];return a=l(b).init(),c=function(){f[d++].then(function(b){return g.push(b),d<e?c():a.resolve(g),b},function(a){return a})},c(),a}function D(c,d,e,f,g,h,i){var j=new XMLHttpRequest,k,m,n={"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, application/json, application/javascript"};return j.open(c,d,!0),q(g,function(a,b){n[b]=a}),q(n,function(a,b){j.setRequestHeader(b,a)}),k=l(b).init(),j.onreadystatechange=function(){j.readyState===4&&(clearTimeout(m),/(200|201|204|304)/.test(j.status)?k.resolve(function(){switch(e){case"xml":return j.responseXML?j.responseXML.documentElement:j.documentElement;case"json":return a(j.responseText);default:return j.responseText}}()):k.resolve(new Error(j.status)))},j.send(i||null),m=setTimeout(function(){j.abort(),h>0?(console.warn(h,": ",d),F(d,e,{timeout:f,headers:g,repeat:h-1,data:i}).then(function(a){return k.resolve(a)},function(){return k.resolve(new Error(j.status))})):k.resolve(new Error("Timeout exceeded"))},f*1e3),k}function E(a,b){return typeof a!="string"&&(a=y([],a,function(a,b,c){return a[a.length]=c+"="+b,a}).join("&")),b?a:encodeURIComponent(a)}function F(a,b,c){c=c||{},c.data&&(a+=(a.indexOf("?")!==-1?"&":"?")+E(c.data,!0));var d=D("GET",a,b,c.timeout||5,c.headers||{},c.repeat||0);return d.then(c.success||!1,c.error||!1),d}function G(a,b,c){c=c||{},c.headers=c.headers||{},c.headers["Content-type"]="application/"+b;var d=D("POST",a,b,c.timeout||20,c.headers,c.repeat||0,c.data?E(c.data,!0):"");return d.then(c.success||!1,c.error||!1),d}function H(a,b,c){c=c||{},c.headers=c.headers||{},c.headers["Content-type"]="application/"+b;var d=D("PUT",a,b,c.timeout||20,c.headers,c.repeat||0,c.data?E(c.data,!0):"");return d.then(c.success||!1,c.error||!1),d}function I(a,b,c){c=c||{};var d=D("DELETE",a,b,c.timeout||5,c.headers||{},c.repeat||0);return d.then(c.success||!1,c.error||!1),d}function J(a,b,c,d){return a._listeners[b][c]||(a._listeners[b][c]=[]),{start:function(){return a._listeners[b][c].push(d),this},stop:function(){var e=a._listeners[b][c].indexOf(d);return e>-1&&a._listeners[b][c].splice(e,1),this}}}function K(){var a=arguments[0],b=arguments[1],c=[],d,e;for(d=1,e=arguments.length;d<e;d++)c[d]=arguments[d];return function(){return a.apply(b,c)}}function L(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);return function(){var c,d=b.length,e=0,f=arguments.length;for(c=0;c<d&&e<f;c++)typeof b[c]=="undefined"&&(b[c]=arguments[e++]);return a.apply(!1,b)}}function M(a,c,d){var e,g,h,i;return Worker?(e=l(b).init(),e.then(c||!1,d||!1),i=new Worker("/worker.js"),i.onmessage=function(b){h=b.data.guid,this.postMessage({type:"load.initial.module",module:a}),f.addWorker(i)},g=f.on("initial.module.loaded",function(b){b.data.guid===h&&(g.stop(),g=null,e.resolve(a))}),e):k(a,c,d)}function k(a,c,d){var e,g;return e=l(b).init(),e.then(c||!1,d||!1),g=f.on("module.initialised",function(b){b.data.moduleName===a&&(g.stop(),g=null,e.resolve(a))}),require(a),e}typeof StopIteration=="undefined"&&(StopIteration=new Error);var b,c,d,e,f,g,h,i,j,k;b={init:function(){return this.deferreds=[],this.status=0,this},then:function(a,b){return this.deferreds.push([a,b]),this.status===1&&this.resolve(),this},resolve:function(a){if(this.status===-1)return;this.status=1;var b=this.deferreds,c=this.result;a=a||this.result;while(b.length>0)(function(){var d=b.shift()[a instanceof Error?1:0];typeof d=="function"&&(a=d(a)||c)})();return this.result=a,this},cancel:function(){this.status=-1}},e={init:function(){return this._listeners={on:{},once:{}},this},fire:function(a,b){return this._fire(l(d).init(a,b))},_fire:function(a){var b;if(typeof debug!="undefined")try{console.log(a.type,a.data||"")}catch(c){}if(typeof this._listeners.once[a.type]!="undefined")while(this._listeners.once[a.type].length>0){b=this._listeners.once[a.type].shift(),b(a);if(a.propogationStopped)return a}return typeof this._listeners.on[a.type]!="undefined"&&t(this._listeners.on[a.type],function(b){return b(a),a.propogationStopped}),a}},q(["on","once"],function(a){e[a]=function(b,c){var d=J(this,a,b,c);return d.start()}}),d={init:function(a,b){return this.type=a,this.data=b||{},this.propogationStopped=!1,this.defaultPrevented=!1,this},stopPropogation:function(){this.propogationStopped=!0},preventDefault:function(){this.propogationStopped=!0,this.defaultPrevented=!0}},c=l(e,{init:function(a){var b,c=this;this.callProto("init"),this.on("send.message",function(a){b.send(c._format("j",JSON.stringify(a.data)))}),this.on("close.socket",function(){b.close()});try{b=new WebSocket(a),b.onopen=function(){c.fire("socket.connected")},b.onmessage=function(a){var d;/~j~/.test(a.data)&&(d=JSON.parse(a.data.split("~j~")[1]),c.fire(d.type,d.data)),/~h~/.test(a.data)&&b.send(c._format("h",a.data.split("~h~")[1]))},b.onclose=function(a){c.fire("socket.closed")},b.onerror=function(a){console.log(a)}}catch(d){console.log(d)}return this},fire:function(a,b){this.callProto("fire",["send.message",{type:a,data:b}])},close:function(){this.callProto("fire",["close.socket"])}}),g=function(){var a=/(-([a-z]))/g;return function(b){return b.replace(a,function(a,b,c){return c.toUpperCase()})}}(),h=function(){var a=/([A-Z])/g;return function(b){return b.replace(a,function(a,b){return"-"+b.toLowerCase()})}}(),i=function(){var a=/^([a-zA-Z])([a-zA-Z]+)/;return function(b){return b.replace(a,function(a,b,c){return b.toUpperCase()+c.toLowerCase()})}}(),j=function(){var a=/{([^{}]*)}/g;return function(b,c){return b.replace(a,function(a,b){var d=c[b];return typeof d=="string"||typeof d=="number"?d:b})}}(),function(){var a,b;b=[],a=l(e).init(),f={fire:function(c,d){var e=a.fire(c,d);return q(b,function(a){a.postMessage({type:c,data:d})}),e},on:function(b,c){return a.on(b,c)},once:function(b,c){return a.once(b,c)},addWorker:function(a){a.onmessage=function(a){f.receive(a.data)},a.onerror=function(a){f.receive({type:"worker.error",data:{message:a.message,filename:a.filename,lineno:a.lineno}})},b.push(a)},receive:function(b){a.fire(b.type,b.data)},loadCommand:function(a){var b=require("/app/commands/"+a)||require("/lib/commands/"+a);if(typeof b=="undefined")throw new Error("cmd: "+a+" does not exist");return b}}}(),q(["log","warn","error"],function(a){f.on("console_"+a,function(b){console[a].apply(console,b.data.args)})}),function(){function g(a){return c[a].def}function h(a,b,d){d=d||{},d.id=d.id||a,c[a]={module:d,def:b}}function i(c){a[c]=!0,F(c,"txt",{headers:{"Cache-Control":"no-cache, must-revalidate, no-store",Pragma:"no-cache"}}).then(function(d){h(c,d),delete a[c],q(b,function(a,b){j(b,a.dependencies,a.def)})})}function j(e,k,l){var m,n;try{delete a[e],b[e]=!0,arguments.length===2&&(l=k,k=[]),k=r(k,function(g){return c[g]?!1:(f.once("module.initialised."+g,function(){j(e,k,l)}),a[g]||b[g]?!0:(/\.\w{2,3}$/.test(g)?i(g):d(g),!0))}),k.length===0&&!c[e]&&(delete b[e],m={},n={path:e},l(g,m,n),h(e,m,n),f.fire("module.initialised."+e,m))}catch(o){console.error(e,o)}}var a={},b={},c={},d,e;typeof importScripts=="function"?d=function(a){if(c[a])return g(a);self.debug||(a+=".min"),importScripts(a+".js")}:(e=document.getElementsByTagName("head")[0],d=function(b){if(c[b])return g(b);a[b]=!0;var d=document.createElement("script");d.id=b,self.debug||(b+=".min"),d.src=b+".js",e.appendChild(d)}),self.require=d,self.define=j,self.require.get=g,self.require.inspect=function(a){console.dir(a?c[a]:c)}}(),define("sys",function(a,b){b.fire=f.fire,b.on=f.on,b.once=f.once,b.loadCommand=f.loadCommand,b._fire=f._fire}),define("object",function(a,b){b.create=l,b.extend=n,b.mixin=m}),define("iter",function(a,b){b.forEach=q,b.filter=r,b.map=s,b.some=t,b.every=u,b.indexOf=v,b.lastIndexOf=w,b.toArray=x,b.reduce=y,b.sum=z,b.pluck=A,b.chain=B,b.iterator=o}),define("events",function(a,b){b.proto=e,b.event=d}),define("async",function(a,c){c.promise=b,c.when=C}),define("net",function(a,b){b.get=F,b.post=G,b.put=H,b.del=I,b.socket=c}),define("func",function(a,b){b.bind=K,b.partial=L}),define("string",function(a,b){b.camelCase=g,b.hyphenate=h,b.capitalise=i,b.interpolate=j}),define("module",function(a,b){b.spawn=M,b.load=k})})(function(string){try{return eval("("+string+")")}catch(e){return console.error(e.message),!1}})